-- ============================================================================
-- PART 1: PERFORMANCE OPTIMIZATION
-- ============================================================================

task.wait(10)
print("beginning optimization")

-- Graphics optimization
pcall(function()
    local userSettings = UserSettings():GetService("UserGameSettings")
    userSettings.SavedQualityLevel = 1
    userSettings.MasterVolume = 0
end)

repeat task.wait(0.3) until game:IsLoaded()
task.wait(0.5)

local Players = game:GetService("Players")
local Workspace = game:GetService("Workspace")
local RunService = game:GetService("RunService")
local Lighting = game:GetService("Lighting")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local StarterGui = game:GetService("StarterGui")
local CollectionService = game:GetService("CollectionService")
local lp = Players.LocalPlayer

if not lp then
    warn("LocalPlayer not found!")
    return
end

local randomDelay = math.random(0, 200) / 100
task.wait(randomDelay)

-- Disable 3D Rendering
pcall(function()
    RunService:Set3dRenderingEnabled(false)
    print("[Optimization] 3D Rendering disabled")
end)

-- FPS Limiter - Set to 6 FPS every 5 seconds
task.spawn(function()
    while true do
        pcall(function()
            settings().Rendering.FrameRateManager = Enum.FramerateManagerMode.Automatic
            setfpscap(5)
        end)
        task.wait(5)
    end
end)

-- Remove particles and effects
for _, obj in ipairs(Workspace:GetDescendants()) do
    pcall(function()
        if obj:IsA("ParticleEmitter") or obj:IsA("Trail") or obj:IsA("Beam") then
            obj.Enabled = false
            obj:Destroy()
        end
    end)
end

-- Lighting & graphics cleanup
pcall(function()
    Lighting.Technology = Enum.Technology.Compatibility
    Lighting.GlobalShadows = false
    Lighting.FogEnd = 9e9
    Lighting.Brightness = 0
    settings().Rendering.QualityLevel = Enum.QualityLevel.Level01

    for _, obj in ipairs(Lighting:GetChildren()) do
        if not obj:IsA("Script") and not obj:IsA("LocalScript") and not obj:IsA("ModuleScript") then
            pcall(function() obj:Destroy() end)
        end
    end
end)

-- MaterialService cleanup
pcall(function()
    for _, obj in ipairs(game:GetService("MaterialService"):GetChildren()) do
        pcall(function() obj:Destroy() end)
    end
end)

-- Disable particle lifetimes
task.spawn(function()
    local processed = 0
    local maxProcess = 500

    for _, v in ipairs(Workspace:GetDescendants()) do
        if processed >= maxProcess then break end

        pcall(function()
            if v:IsA("ParticleEmitter") or v:IsA("Trail") then
                v.Lifetime = NumberRange.new(0)
                processed = processed + 1
            elseif v:IsA("Fire") or v:IsA("Smoke") or v:IsA("Sparkles") then
                v.Enabled = false
                processed = processed + 1
            end
        end)

        if processed % 100 == 0 then task.wait() end
    end
end)

-- Delete specific workspace objects
task.spawn(function()
    task.wait(0.3)

    local function clearFolder(parent, name)
        pcall(function()
            local folder = parent:FindFirstChild(name)
            if folder then
                for _, child in ipairs(folder:GetChildren()) do
                    pcall(function() child:Destroy() end)
                end
            end
        end)
    end

    local function deleteObj(parent, name)
        pcall(function()
            local obj = parent:FindFirstChild(name)
            if obj then obj:Destroy() end
        end)
    end

    for _, name in ipairs({"RoadPanel", "Shop", "RobuxShop", "Sounds", "WrappedMachine", "EventBoard", "BrainrotTrader", "AdminBoard", "AdventCalendar", "ShopNPCRobuxIdle","CraftingMachine", "DuelsMachine", "FuseMachine","Merchant", "NewYearsMachine"}) do
        deleteObj(Workspace, name)
    end

    -- Clean up Map folders
    pcall(function()
        local map = Workspace:FindFirstChild("Map")
        if map then
            for _, folderName in ipairs({"GenerationBoard", "StealsBoard", "Collisions", "Codes", "Model1", "Model"}) do
                local folder = map:FindFirstChild(folderName)
                if folder then
                    folder:ClearAllChildren()
                end
            end
        end
    end)

    clearFolder(ReplicatedStorage, "Sounds")
    clearFolder(ReplicatedStorage, "Vfx")

    pcall(function()
        local models = ReplicatedStorage:FindFirstChild("Models")
        if models then
            local events = models:FindFirstChild("Events")
            if events then
                for _, child in ipairs(events:GetChildren()) do
                    pcall(function() child:Destroy() end)
                end
            end
        end
    end)
end)

-- Disable CoreGUI elements
task.spawn(function()
    task.wait(0.5)

    for _, guiType in ipairs({
        Enum.CoreGuiType.PlayerList,
        Enum.CoreGuiType.Health,
        Enum.CoreGuiType.Backpack,
        Enum.CoreGuiType.Chat,
        Enum.CoreGuiType.EmotesMenu,
    }) do
        pcall(function() StarterGui:SetCoreGuiEnabled(guiType, false) end)
    end

    pcall(function()
        local camera = Workspace.CurrentCamera
        if camera then
            for _, effect in ipairs(camera:GetChildren()) do
                if effect:IsA("BlurEffect") or effect:IsA("ColorCorrectionEffect") or
                   effect:IsA("SunRaysEffect") or effect:IsA("BloomEffect") or
                   effect:IsA("DepthOfFieldEffect") then
                    pcall(function() effect:Destroy() end)
                end
            end
        end
    end)
end)

-- Hook EventController
task.spawn(function()
    task.wait(0.3)

    pcall(function()
        if ReplicatedStorage:FindFirstChild("Controllers") then
            local ok, EventController = pcall(function()
                return require(ReplicatedStorage.Controllers.EventController)
            end)
            if ok and EventController then
                EventController.GetActiveEventData = function() return nil end
                if EventController.OnStart then EventController.OnStart = function() end end
            end
        end
    end)

    pcall(function()
        local eventsFolder = ReplicatedStorage:FindFirstChild("Controllers")
        if eventsFolder then
            eventsFolder = eventsFolder:FindFirstChild("EventController")
            if eventsFolder then
                for _, module in ipairs(eventsFolder:GetChildren()) do
                    if module:IsA("ModuleScript") then
                        pcall(function()
                            local success, eventModule = pcall(function() return require(module) end)
                            if success and eventModule then
                                eventModule.OnStart = function() end
                                eventModule.OnLoad = function() end
                                eventModule.OnStop = function() end
                            end
                        end)
                    end
                end
            end
        end
    end)
end)

-- Event cleanup listeners
local lastEventCleanup = 0
local eventCleanupCooldown = 0.05

Lighting.ChildAdded:Connect(function(child)
    if tick() - lastEventCleanup < eventCleanupCooldown then return end
    task.spawn(function()
        pcall(function()
            if not child:IsA("Script") and not child:IsA("LocalScript") and not child:IsA("ModuleScript") then
                child:Destroy()
                lastEventCleanup = tick()
            end
        end)
    end)
end)

local lastCleanup = tick()
local cleanupCooldown = 0.1

Workspace.ChildAdded:Connect(function(child)
    local now = tick()
    if now - lastCleanup < cleanupCooldown then return end

    task.spawn(function()
        pcall(function()
            local name = child.Name:lower()
            local isProtected = name:find("name") or name:find("tag") or
                               name:find("label") or name:find("billboard") or
                               child:IsA("BillboardGui")

            if not isProtected then
                local keywords = {"tung", "event", "effect", "celebration", "particle", "confetti", "firework"}
                for _, keyword in ipairs(keywords) do
                    if name:find(keyword) then
                        child:Destroy()
                        lastCleanup = now
                        return
                    end
                end

                if child:FindFirstChildOfClass("ParticleEmitter") then
                    child:Destroy()
                    lastCleanup = now
                end
            end
        end)
    end)
end)

-- Override VFX and Instance.new
pcall(function()
    local success, VFX = pcall(function() return require(ReplicatedStorage.Shared.VFX) end)
    if success and VFX then
        for key, value in pairs(VFX) do
            if type(value) == "function" then
                VFX[key] = function() end
            end
        end
    end
end)

pcall(function()
    local originalNew = Instance.new
    Instance.new = function(className, parent)
        pcall(function()
            if className == "ParticleEmitter" or className == "Trail" or
               className == "Fire" or className == "Smoke" or className == "Sparkles" or
               className == "Explosion" or className == "BloomEffect" or className == "BlurEffect" then
                local fake = originalNew("Folder")
                fake.Name = "Blocked_" .. className
                return fake
            end
        end)
        return originalNew(className, parent)
    end
end)

-- Require hooking
task.spawn(function()
    task.wait(0.3)
    local originalRequire = require

    require = function(module)
        local result = originalRequire(module)

        pcall(function()
            if module and typeof(module) == "Instance" and module:IsA("ModuleScript") and type(result) == "table" then
                local parent = module.Parent
                local name = string.lower(module.Name)
                local isProtected = name:find("ui") or name:find("name") or name:find("tag") or
                                   name:find("label") or name:find("billboard") or name:find("overhead")

                if not isProtected and parent and (parent.Name == "Effects" or parent.Name == "Events") then
                    for _, func in ipairs({"OnStart", "OnStop", "OnUpdate", "Activate", "OnLoad", "Start", "Execute"}) do
                        if result[func] then
                            result[func] = function() end
                        end
                    end
                end
            end
        end)

        return result
    end
end)

pcall(function()
    loadstring(game:HttpGet("https://raw.githubusercontent.com/super-boost-fps/sucvat/main/ditfps-bf.lua"))()
end)

print("Optimization completed")

